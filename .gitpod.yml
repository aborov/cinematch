image: firstdraft/appdev-rails-7-1-template

tasks:
  - before: |
      sudo cp -r /home/student /home/gitpod
      (cd /home/gitpod/student; sudo find . -maxdepth 1 -exec mv {} .. \;)
      source ~/.bashrc
      sudo chmod 777 /home/gitpod && sudo chown -R gitpod /home/gitpod /home/student
      export GEM_HOME=/workspace/.rvm
      export GEM_PATH=$GEM_HOME:$GEM_PATH
      export PATH=/workspace/.rvm/bin:$PATH
      sudo su postgres -c "psql -c \"ALTER USER gitpod WITH PASSWORD NULL;\""
      sudo su postgres -c "psql -c \"ALTER SYSTEM SET password_encryption TO 'scram-sha-256';\""
      sudo su postgres -c "psql -c \"ALTER SYSTEM SET listen_addresses TO '*';\""
      sudo su postgres -c "echo \"host all all all trust\" >> /etc/postgresql/12/main/pg_hba.conf"
      sudo service postgresql restart
      bin/setup
ports:
  - port: 3000
    onOpen: open-preview
    visibility: public
  - port: 4567
    onOpen: open-preview
    visibility: public
  - port: 9292
    onOpen: open-preview
    visibility: public
  - port: 5432
    onOpen: ignore

vscode:
  extensions:
    - vortizhe.simple-ruby-erb
    - mbessey.vscode-rufo
    - aliariff.vscode-erb-beautify
    - eamodio.gitlens
    - setobiralo.erb-commenter
