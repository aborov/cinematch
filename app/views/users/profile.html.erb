<div class="container-fluid d-flex justify-content-center align-items-center" style="min-height: calc(100vh - 200px);">
  <div class="card w-100" style="max-width: 800px;">
    <div class="card-header">
      <h2 class="mb-0">Your Profile</h2>
    </div>
    <div class="card-body p-0">
      <div class="accordion w-100" id="profileAccordion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="settingsHeading">
            <button class="accordion-button rounded-0" type="button" data-bs-toggle="collapse" data-bs-target="#settingsCollapse" aria-expanded="true" aria-controls="settingsCollapse">
              User Settings
            </button>
          </h2>
          <div id="settingsCollapse" class="accordion-collapse collapse show" aria-labelledby="settingsHeading" data-bs-parent="#profileAccordion">
            <div class="accordion-body">
              <%= link_to "Edit Account Data", edit_user_registration_path, class: "btn btn-primary" %>
              <h3 class="mt-4">Edit Personal Information</h3>
              <%= render "users/edit" %>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header" id="personalityProfileHeading">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#personalityProfileCollapse" aria-expanded="false" aria-controls="personalityProfileCollapse">
              Personality Profile
            </button>
          </h2>
          <div id="personalityProfileCollapse" class="accordion-collapse collapse" aria-labelledby="personalityProfileHeading" data-bs-parent="#profileAccordion">
            <div class="accordion-body">
              <% if @user.user_preference.present? %>
                <% if @user.user_preference.personality_profiles.present? %>
                  <% personality_profiles = @user.user_preference.personality_profiles %>
                  <% if personality_profiles.is_a?(String) %>
                    <% personality_profiles = eval(personality_profiles) %>
                  <% end %>
                  <h3>Your Big Five Personality Profile</h3>
                  <ul class="list-group list-group-flush">
                    <% personality_profiles.each do |trait, score| %>
                      <li class="list-group-item"><%= trait.capitalize %>: <%= score %></li>
                    <% end %>
                  </ul>
                  <%= link_to "Retake Personality Survey", surveys_path, class: "btn btn-primary mt-3" %>
                <% else %>
                  <div class="alert alert-warning" role="alert">
                    No personality profile available. Please complete the <%= link_to "survey", surveys_path, class: "alert-link" %> to receive recommendations.
                  </div>
                <% end %>
              <% else %>
                <div class="alert alert-warning" role="alert">
                  No preferences found. Please complete the <%= link_to "survey", surveys_path, class: "alert-link" %> to receive recommendations.
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header" id="contentPreferencesHeading">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#contentPreferencesCollapse" aria-expanded="false" aria-controls="contentPreferencesCollapse">
              Content Preferences
            </button>
          </h2>
          <div id="contentPreferencesCollapse" class="accordion-collapse collapse" aria-labelledby="contentPreferencesHeading" data-bs-parent="#profileAccordion">
            <div class="accordion-body">
              <h3>Edit Content Preferences</h3>

              <%= form_with model: @user_preference, local: true do |form| %>
                <div class="mb-3">
                  <%= form.label :favorite_genres, "Select your favorite genres", class: "form-label" %><br>
                  <div class="btn-group-toggle d-flex flex-wrap" data-toggle="buttons">
                    <% @genres.each do |genre| %>
                      <%= form.check_box :favorite_genres, { :multiple => true, :class => "btn-check", :id => genre["name"].parameterize }, genre["name"], nil %>
                      <%= label_tag genre["name"].parameterize, genre["name"], { :class => "btn btn-outline-primary m-1" } %>
                    <% end %>
                  </div>
                </div>
                <div>
                  <%= form.submit "Save Preferences", { :class => "btn btn-primary" } %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
